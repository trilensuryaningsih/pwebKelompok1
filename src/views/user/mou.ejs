<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>UMCental Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <style>
        .bg-custom-dark {
            background-color: #181C14;
        }

        .bg-custom-green {
            background-color: #697565;
        }

        .bg-custom-green-dark {
            background-color: #5a6356;
        }

        .focus\:ring-custom-green:focus {
            --tw-ring-color: rgba(105, 117, 101, 0.5);
        }
    </style>
</head>

<body class="flex min-h-screen bg-[#f5f0e9] ">

    <%- include('../partials/sidebar') %>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <%- include('../partials/header') %>

                <!-- Content -->
                <section class="flex-1 p-8 overflow-auto flex-1 p-6 flex flex-col">
                    <form id="mou-form" class="bg-white rounded-xl p-8 h-full flex flex-col justify-between min-h-[2000px] max-w-5xl mx-auto" autocomplete="off">
                    <h2 class="text-[#7F6D6D] font-semibold text-lg mb-6">
                    SURAT PERJANJIAN KERJASAMA<br/>
                    <span class="font-normal text-base">Memorandum of Understanding</span>
                    </h2>
                    <div class="space-y-4 text-[#7F6D6D] text-sm font-light max-w-4xl">
                    <p>
                        Pada tanggal
                        <select disabled aria-label="Tanggal" class="border border-[#7F6D6D] rounded px-2 py-1 w-16 text-xs text-[#7F6D6D] font-light bg-gray-100 cursor-not-allowed" name="tanggal" id="tanggal-select">
                            <% for(let i=1; i<=31; i++) { %>
                                <option value="<%= i.toString().padStart(2, '0') %>"><%= i.toString().padStart(2, '0') %></option>
                            <% } %>
                        </select>
                        bulan
                        <select disabled aria-label="Bulan" class="border border-[#7F6D6D] rounded px-2 py-1 w-24 text-xs text-[#7F6D6D] font-light bg-gray-100 cursor-not-allowed" name="bulan" id="bulan-select">
                            <option value="Januari">Januari</option>
                            <option value="Februari">Februari</option>
                            <option value="Maret">Maret</option>
                            <option value="April">April</option>
                            <option value="Mei">Mei</option>
                            <option value="Juni">Juni</option>
                            <option value="Juli">Juli</option>
                            <option value="Agustus">Agustus</option>
                            <option value="September">September</option>
                            <option value="Oktober">Oktober</option>
                            <option value="November">November</option>
                            <option value="Desember">Desember</option>
                        </select>
                        tahun
                        <select disabled aria-label="Tahun" class="border border-[#7F6D6D] rounded px-2 py-1 w-20 text-xs text-[#7F6D6D] font-light bg-gray-100 cursor-not-allowed" name="tahun" id="tahun-select">
                            <% for(let t=2024; t<=2028; t++) { %>
                                <option value="<%= t %>"><%= t %></option>
                            <% } %>
                        </select>
                        , kami yang bertanda tangan di bawah ini:
                    </p>
                    <div class="space-y-1">
                        <label class="block text-xs" for="nama1">
                        Nama
                        </label>
                        <label class="block text-xs" for="nama1">
                        Toni Windra
                        </label>
                    </div>
                    <div class="space-y-1">
                        <label class="block text-xs" for="instansi1">
                        Instansi
                        </label>
                        <label class="block text-xs" for="nama1">
                        Universal Multimedia Creative
                        </label>
                        </div>
                    <div class="space-y-1">
                        <label class="block text-xs" for="jabatan1">
                        Jabatan
                        </label>
                        <label class="block text-xs" for="nama1">
                        CEO
                        </label>
                    </div>
                    <div class="space-y-1">
                        <label class="block text-xs" for="kontak1">
                        Kontak
                        </label>
                        <label class="block text-xs" for="nama1">
                        085174461775
                        </label>
                    </div>
                    <p class="mb-4">
                        Dalam hal ini bertindak sebagai <strong>Pihak I</strong>
                    </p>
                    <div class="space-y-1">
                        <label class="block text-xs" for="nama2">
                        Nama
                        </label>
                        <input class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="nama2" name="nama2" placeholder="" type="text"/>
                    </div>
                    <div class="space-y-1">
                        <label class="block text-xs" for="instansi2">
                        Instansi
                        </label>
                        <input class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="instansi2" name="instansi2" placeholder="" type="text"/>
                    </div>
                    <div class="space-y-1">
                        <label class="block text-xs" for="jabatan2">
                        Jabatan
                        </label>
                        <input class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="jabatan2" name="jabatan2" placeholder="" type="text"/>
                    </div>
                    <div class="space-y-1">
                        <label class="block text-xs" for="kontak2">
                        Kontak
                        </label>
                        <input class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="kontak2" name="kontak2" placeholder="" type="text"/>
                    </div>
                    <p class="mb-4">
                        Dalam hal ini bertindak sebagai <strong>Pihak II</strong>
                    </p>
                    <p class="mb-4">
                        Kedua pihak sepakat untuk mengadakan kerja sama dengan ketentuan-ketentuan sebagai berikut:
                    </p>
                    <h3 class="font-semibold text-[#7F6D6D] mb-2 text-sm">
                        Pasal 1<br/>
                        NAMA DAN WAKTU PELAKSANAAN
                    </h3>
                    <p class="mb-2">
                        Pihak I dan Pihak II telah sepakat kerja sama dalam kegiatan:
                    </p>
                    <div class="space-y-1 mb-4">
                        <label class="block text-xs" for="namaKegiatan">
                        Nama Kegiatan
                        </label>
                        <input class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="namaKegiatan" name="namaKegiatan" placeholder=""/>
                    </div>
                    <div class="space-y-1 mb-4">
                        <label class="block text-xs" for="hariTanggal">
                        Hari/Tanggal
                        </label>
                        <input type="date" class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="hariTanggal" name="hariTanggal" />
                    </div>
                    <div class="space-y-1 mb-4">
                        <label class="block text-xs" for="tempat">
                        Tempat
                        </label>
                        <input class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="tempat" name="tempat" placeholder=""/>
                    </div>
                    <h3 class="font-semibold text-[#7F6D6D] mb-2 text-sm">
                        Pasal 2<br/>
                        PERATURAN KERJA SAMA
                    </h3>
                    <p class="mb-2 font-light">
                        PENYEDIAAN BARANG DAN JASA 
                    </p>
                    <ol class="list-decimal list-inside space-y-1 text-xs font-light mb-4">
                        <li>
                            Barang yang dipinjamkan oleh Pihak I meliputi, perlengkapan yang diperlukan untuk kegiatan fotografi atau videografi.
                        </li>
                        <li>
                            Jasa yang disediakan oleh Pihak I meliputi, tim produksi visual sesuai kebutuhan Pihak II.
                        </li>
                        <li>
                            Pihak II wajib memberikan informasi yang jelas mengenai spesifikasi dan jumlah barang yang diperlukan serta jadwal penggunaan jasa fotografi atau videografi.
                        </li>
                        <li>
                            Pihak II bertanggung jawab atas keamanan barang yang dipinjamkan selama masa peminjaman dan akan mengganti barang yang rusak atau hilang sesuai kesepakatan harga.
                        </li>
                        <li>
                            Pihak I akan menyediakan barang dan jasa sesuai dengan spesifikasi yang telah disepakati dan dalam kondisi yang baik pada waktu peminjaman.
                        </li>
                        <li>
                            Pihak II bertanggung jawab untuk menggunakan barang dan jasa sesuai dengan ketentuan yang telah disepakati dan tidak melakukan tindakan yang merusak atau mengubah barang tersebut tanpa izin dari Pihak I.
                        </li>
                        <li>
                            Pembayaran sewa barang dan jasa akan dilakukan oleh Pihak II sesuai dengan tarif yang telah disepakati sebelum kegiatan dimulai.
                        </li>
                        <li>
                            Pihak II wajib menyerahkan bukti pemesanan atau pembayaran setelah menerima barang atau menggunakan jasa untuk keperluan administrasi Pihak I.
                        </li>
                    </ol>
                    <h3 class="font-semibold text-[#7F6D6D] mb-2 text-sm">
                        Pasal 3<br/>
                        PENYELESAIAN PERSELISIHAN
                    </h3>
                    <p class="mb-4 text-xs font-light">
                        Apabila terjadi suatu perselisihan antara Pihak I dan Pihak II sehubungan dengan pelaksanaan perjanjian kerjasama ini akan diselesaikan secara musyawarah mufakat oleh kedua belah pihak.
                    </p>
                    <h3 class="font-semibold text-[#7F6D6D] mb-2 text-sm">
                        Pasal 4<br/>
                        HAK CIPTA DAN PENGGUNAAN KONTEN
                    </h3>
                    <p class="mb-4 text-xs font-light">
                        Semua hasil rekaman dan dokumentasi yang dihasilkan selama kegiatan, termasuk foto dan video, dapat digunakan oleh kedua belah pihak untuk keperluan promosi, dokumentasi, dan publikasi dengan tetap mencantumkan kredit kepada masing-masing pihak sesuai kontribusi.
                    </p>
                    <h3 class="font-semibold text-[#7F6D6D] mb-2 text-sm">
                        Pasal 5<br/>
                        KETENTUAN LAIN
                    </h3>
                    <p class="mb-4 text-xs font-light">
                        Hal-hal lain yang berkenaan dengan perjanjian ini dan hal-hal lain yang belum diatur pada perjanjian ini akan dimusyawarahkan kedua belah pihak
                    </p>
                    <p class="mb-8 text-xs font-light">
                        Dengan ini Surat Perjanjian Kerjasama ini dibuat serta ditandatangani oleh kedua belah pihak.
                    </p>
                    <div class="mb-8">
                        <p class="mb-6">
                        Padang,
                        <input type="date" aria-label="Tanggal penandatanganan" class="border border-[#7F6D6D] rounded px-2 py-1 w-32 text-xs text-[#7F6D6D] font-light" name="tanggalPenandatanganan" />
                        </p>
                        <div class="flex justify-between max-w-3xl">
                        <div class="flex flex-col items-center space-y-1 text-xs font-light">
                        <span>
                        Pihak I,
                        </span>
                        <label>
                        Pihak Penyedia Layanan
                        </label>
                        <span class="block h-16 w-48 border-b border-[#7F6D6D]">
                        </span>
                        </div>
                        <div class="flex flex-col items-center space-y-1 text-xs font-light">
                        <span>
                        Pihak II,
                        </span>
                        <input class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="jabatan3" name="jabatan3" placeholder="Jabatan Pihak II" type="text"/>
                        <div class="mt-2">
                            <label class="block text-xs mb-1" for="ttdPihak2">Tanda Tangan (upload gambar)</label>
                            <input type="file" accept="image/*" id="ttdPihak2" name="ttdPihak2" class="block w-full text-xs text-[#7F6D6D]" />
                            <img id="preview-ttdPihak2" src="#" alt="Preview Tanda Tangan" class="mt-2 max-h-24 hidden border rounded" />
                        </div>
                        <span class="block h-16 w-48 border-b border-[#7F6D6D]">
                        </span>
                        </div>
                        </div>
                        <div class="flex justify-between max-w-3xl mt-2 text-xs font-light">
                        <div>
                        <span>
                        Toni Windra <br>
                        NIM.2111517002
                        </span>
                        </div>
                        <div class="text-right">
                        <span>
                        <input class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="nama3" name="nama3" placeholder="Nama Pihak II" type="text"/><br/>
                        NIM.<input class="border border-[#7F6D6D] rounded px-2 py-1 w-full text-xs text-[#7F6D6D] font-light" id="nim" name="nim" placeholder="NIM Pihak II" type="text"/>
                        </span>
                        </div>
                        </div>
                    </div>
                    </div>
                    <div class="flex justify-between text-xs text-[#7F6D6D] font-light">
                    <button id="btn-kembali" class="mx-auto mt-auto border border-[#7F6D6D] rounded-full px-6 py-1 text-xs text-[#7F6D6D] hover:bg-[#D9D0C7]" type="button">
                        Kembali
                    </button>
                    <button id="btn-submit" class="mx-auto mt-auto border border-[#7F6D6D] rounded-full px-6 py-1 text-xs text-[#7F6D6D] hover:bg-[#D9D0C7]" type="button">
                        Submit
                    </button>
                    </div>
                    <div id="success-message" class="hidden mt-4 text-green-600 font-semibold text-center">Data berhasil disimpan!</div>
                    <!-- Modal Pop Up -->
                    <div id="modal-success" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
                        <div class="bg-white rounded-lg p-8 shadow-lg max-w-xs w-full text-center">
                            <div class="text-green-600 text-2xl mb-2"><i class="fas fa-check-circle"></i></div>
                            <div class="mb-4 text-[#7F6D6D] font-semibold">Data berhasil disimpan!</div>
                            <button id="btn-modal-cetak" class="mt-2 px-4 py-1 rounded bg-custom-green text-white">Cetak MOU</button>
                        </div>
                    </div>
                    </form>
                    </section>
                <%- include('../partials/footer') %>
        </div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const date = today.getDate().toString().padStart(2, '0');
        const month = today.toLocaleString('id-ID', { month: 'long' });
        const year = today.getFullYear();

        document.getElementById('tanggal-select').value = date;
        document.getElementById('bulan-select').value = month;
        document.getElementById('tahun-select').value = year;

        const btnSubmit = document.getElementById('btn-submit');
        const successMessage = document.getElementById('success-message');
        const form = document.querySelector('form');

        // Preview tanda tangan upload
        const ttdInput = document.getElementById('ttdPihak2');
        const ttdPreview = document.getElementById('preview-ttdPihak2');
        ttdInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                    ttdPreview.src = ev.target.result;
                    ttdPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                ttdPreview.src = '#';
                ttdPreview.classList.add('hidden');
            }
        });

        // Ganti event listener ke tombol submit
        btnSubmit.addEventListener('click', function(e) {
            e.preventDefault();
            btnSubmit.disabled = true;
            btnSubmit.textContent = 'Menyimpan...';
            successMessage.classList.add('hidden');
            const data = {};
            data.tanggal = document.getElementById('tanggal-select').value;
            data.bulan = document.getElementById('bulan-select').value;
            data.tahun = document.getElementById('tahun-select').value;
            data.nama2 = document.getElementById('nama2').value;
            data.instansi2 = document.getElementById('instansi2').value;
            data.jabatan2 = document.getElementById('jabatan2').value;
            data.kontak2 = document.getElementById('kontak2').value;
            data.namaKegiatan = document.getElementById('namaKegiatan').value;
            data.hariTanggal = document.getElementById('hariTanggal').value;
            data.tempat = document.getElementById('tempat').value;
            data.tanggalPenandatanganan = document.querySelector('input[name="tanggalPenandatanganan"]').value;
            data.jabatan3 = document.getElementById('jabatan3').value;
            data.nama3 = document.getElementById('nama3').value;
            data.nim = document.getElementById('nim').value;
            // Tanda tangan (base64)
            const file = ttdInput.files[0];
            const reader = new FileReader();
            reader.onload = async function(ev) {
                data.ttdPihak2 = ev.target.result;
                // Ambil data pesanan dari localStorage
                const pemesananData = localStorage.getItem('pemesananData');
                let pesananPayload = {};
                if (pemesananData) {
                    pesananPayload = JSON.parse(pemesananData);
                }
                // Kirim data MOU ke backend
                fetch('/user/mou', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...data,
                        orderData: pesananPayload
                    })
                }).then(response => response.json())
                .then(result => {
                    if (result.success) {
                        // Tampilkan pesan berhasil, disable submit
                        successMessage.classList.remove('hidden');
                        btnSubmit.disabled = true;
                        btnSubmit.textContent = 'Submit';
                        // Tampilkan modal pop up dengan hanya button cetak
                        const modal = document.getElementById('modal-success');
                        const modalContent = modal.querySelector('.bg-white');
                        modalContent.innerHTML = `
                            <div class="text-green-600 text-2xl mb-2"><i class="fas fa-check-circle"></i></div>
                            <div class="mb-4 text-[#7F6D6D] font-semibold">Data berhasil disimpan!</div>
                            <button id="btn-modal-cetak" class="mt-2 px-4 py-1 rounded bg-custom-green text-white">Cetak MOU</button>
                        `;
                        modal.classList.remove('hidden');
                        // Hapus data pemesanan dari localStorage
                        localStorage.removeItem('pemesananData');
                    } else {
                        // Tampilkan pesan error
                        alert(result.message || 'Gagal menyimpan data');
                        btnSubmit.disabled = false;
                        btnSubmit.textContent = 'Submit';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Terjadi kesalahan saat menyimpan data');
                    btnSubmit.disabled = false;
                    btnSubmit.textContent = 'Submit';
                });
            };
            reader.readAsDataURL(file);
        });

        document.addEventListener('click', function(e) {
            if (e.target.id === 'btn-modal-cetak') {
                document.getElementById('modal-success').classList.add('hidden');
                window.open('/user/cetak-mou', '_blank');
            }
        });
    });
</script>
</body>

</html>