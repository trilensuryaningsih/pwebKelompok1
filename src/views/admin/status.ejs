<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF--8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manajemen Alat dan Jasa Dashboard</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            'brand-beige': '#DED9CE', 'brand-brown': { DEFAULT: '#6C6154', 'light': '#A8A288', 'dark': '#403f36' }, 'brand-olive': { light: '#859984', DEFAULT: '#7C8779', medium: '#65745d', dark: '#4a4f3b' }, 'brand-dark-gray': '#2B2B2B',
          },
          keyframes: {
            'fade-in-down': {
              '0%': { opacity: '0', transform: 'translateY(-10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            'fade-out-up': {
              '0%': { opacity: '1', transform: 'translateY(0)' },
              '100%': { opacity: '0', transform: 'translateY(-10px)' },
            }
          },
          animation: {
            'fade-in-down': 'fade-in-down 0.5s ease-out forwards',
            'fade-out-up': 'fade-out-up 0.5s ease-out forwards',
          }
        }
      }
    }
  </script>
  
  <style>
    .no-scrollbar { scrollbar-width: none; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
  </style>
</head>

<body class="bg-brand-beige text-brand-brown font-sans flex flex-col min-h-screen">
  <div id="notification-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div>

  <div class="app grid lg:grid-cols-[240px_1fr] flex-grow" role="main">
    
    <aside class="bg-brand-olive text-brand-beige flex flex-col items-center p-3 lg:p-0 lg:pt-12 sticky top-0 h-screen z-10">
        <div class="logo w-12 h-12 mb-8 hidden lg:block" aria-label="Logo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" class="fill-brand-dark-gray w-12 h-12"><path d="M11.122 21.455a1.1 1.1 0 0 0-1.101 1.102v.02a1.1 1.1 0 0 0 1.101 1.101h7.455a1.1 1.1 0 0 0 1.1-1.101 1.1 1.1 0 0 0-1.1-1.102h-.145v-.02h.08a3.3 3.3 0 0 0 0-6.6h-.08v-.019h.145a1.1 1.1 0 0 0 1.1-1.101 1.1 1.1 0 0 0-1.1-1.102h-7.45a1.1 1.1 0 0 0-1.101 1.101v.021a1.1 1.1 0 0 0 1.101 1.101h.036v.082c0 .056 0 .112.004.167a1.211 1.211 0 0 0 0 .168v.081h-.036Zm2.423-3.193h4.194a1.034 1.034 0 0 1 .052 2.067l-.052.001h-4.188a1.034 1.034 0 0 1-.052-2.067l.051-.001Zm-8.635-3.625c-.807 0-1.123.31-1.123.977v15.379c0 .62.307.938 1.104.962l.031.001c.004-.002.007-.003.009-.005l14.941-7.654a1.1 1.1 0 0 0 .004-1.968L7.399 14.638l-.03-.006-.01-.004-.02-.009a.812.812 0 0 0-.043-.01h-.003a.965.965 0 0 0-.05-.015 1.219 1.219 0 0 0-.16-.036l-.015-.003-.006-.001-.003-.001-.001-.001a.574.574 0 0 0-.11-.011ZM33.068 29.71v-6.205a4.076 4.076 0 0 0-4.075-4.075h-6.809a1.1 1.1 0 0 0 0 2.2h6.82a1.872 1.872 0 0 1 1.872 1.874v6.21c0 .525.464.97 1.041.97h.005a1.05 1.05 0 0 0 1.016-1.055Zm-2.531-6.836a1.041 1.041 0 1 0 0 2.082 1.041 1.041 0 0 0 0-2.082Zm-7.564 2.81v-.085a1.098 1.098 0 0 0-2.195 0v.086c0 1.112-.877 2.014-2.243 2.014-1.365 0-2.244-.902-2.244-2.014v-.086a1.098 1.098 0 0 0-2.195 0v.086c0 2.274 1.663 4.202 4.439 4.202 2.78 0 4.442-1.928 4.442-4.202ZM39.795 9v27.53h3.5V9h-3.5Zm1.75-6.6a2.852 2.852 0 1 0 0 5.705 2.852 2.852 0 0 0 0-5.705Z" /></svg>
        </div>
        <nav class="flex flex-col w-full gap-4 hidden lg:flex">
            <a href="#" class="hover:bg-brand-olive-dark text-left py-2.5 px-4 rounded-full transition-colors" role="button">Dashboard</a>
            <a href="/admin/daftar" class="bg-brand-olive-dark font-bold text-left py-2.5 px-4 rounded-full transition-colors" aria-current="page" role="button">Manajemen Alat dan jasa</a>
            <a href="#" class="hover:bg-brand-olive-dark text-left py-2.5 px-4 rounded-full transition-colors" role="button">Verifikasi peminjaman</a>
            <a href="#" class="hover:bg-brand-olive-dark text-left py-2.5 px-4 rounded-full transition-colors" role="button">Pesanan</a>
            <a href="#" class="hover:bg-brand-olive-dark text-left py-2.5 px-4 rounded-full transition-colors" role="button">Feedback</a>
        </nav>
    </aside>

    <div class="flex flex-col w-full">
      <header class="bg-brand-beige px-5 lg:px-10 py-4 flex justify-between items-center gap-4 sticky top-0 lg:relative border-b border-brand-brown/30 lg:border-none">
          <div class="flex items-center gap-4 ml-auto">
              <button class="bg-brand-olive hover:bg-brand-olive-dark text-brand-beige rounded-full w-9 h-9 flex justify-center items-center transition-colors" aria-label="Notifikasi"><span class="material-icons text-xl">notifications</span></button>
              <div class="border border-brand-brown text-brand-brown font-semibold py-1.5 px-3 rounded-xl hidden sm:block">Admin</div>
              <button class="bg-brand-olive hover:bg-brand-olive-dark text-brand-beige rounded-full w-9 h-9 flex justify-center items-center transition-colors" aria-label="Profil pengguna"><span class="material-icons text-xl">person</span></button>
          </div>
      </header>
      
      <main class="content p-5 lg:p-10 flex flex-col gap-6 bg-brand-beige">
        <div class="flex flex-wrap justify-between items-center gap-4">
          <div class="status-filters flex gap-2"></div>
          <a href="/admin/fines/history-page" class="bg-brand-olive text-brand-beige px-4 py-2 rounded hover:bg-brand-olive-dark font-semibold">Riwayat Denda</a>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full rounded-xl overflow-hidden bg-brand-olive text-brand-beige">
              <thead class="bg-brand-olive">
                <tr>
                  <th scope="col" class="p-4 px-3 text-left font-semibold align-middle">No</th>
                  <th scope="col" class="p-4 px-3 text-left font-semibold align-middle">Nama</th>
                  <th scope="col" class="p-4 px-3 text-left font-semibold align-middle">Kategori</th>
                  <th scope="col" class="p-4 px-3 text-left font-semibold align-middle">Deskripsi</th>
                  <th scope="col" class="p-4 px-3 text-left font-semibold align-middle">Status</th>
                </tr>
              </thead>
              <tbody class="bg-brand-beige text-brand-brown">
                <% if (typeof items !== 'undefined' && items.length > 0) { %>
                  <% items.forEach((item, index) => { %>
                    <tr id="item-row-<%= item.id %>" class="border-b border-brand-brown-light">
                      <td class="row-number p-4 px-3 align-middle font-bold text-sm"><%= index + 1 %></td>
                      <td class="p-4 px-3 align-middle font-bold text-sm"><%= item.nama %></td>
                      <td class="p-4 px-3 align-middle font-bold text-sm"><%= item.kategori %></td>
                      <td class="p-4 px-3 align-middle font-bold text-sm"><%= item.deskripsi %></td>
                      <td class="p-4 px-3 align-middle">
                        <% if (item.status === 'Tersedia') { %>
                          <span class="border-2 border-green-800 text-green-800 font-semibold text-sm rounded-full py-1 px-3"><%= item.status %></span>
                        <% } else if (item.status === 'Dipinjam') { %>
                          <span class="border-2 border-amber-600 text-amber-600 font-semibold text-sm rounded-full py-1 px-3"><%= item.status %></span>
                        <% } else { %>
                          <span class="border-2 border-gray-500 text-gray-500 font-semibold text-sm rounded-full py-1 px-3"><%= item.status %></span>
                        <% } %>
                      </td>
                      
                      
                    </tr>
                  <% }) %>
                <% } else { %>
                  <tr>
                    <td colspan="7" class="text-center p-5">Tidak ada data untuk ditampilkan.</td>
                  </tr>
                <% } %>
              </tbody>
            </table>
        </div>

        <% if (typeof fines !== 'undefined' && fines.length > 0) { %>
          <h2 class="text-xl font-bold mt-10 mb-4">Daftar Denda</h2>
          <div class="overflow-x-auto mb-8">
            <table class="w-full rounded-xl overflow-hidden bg-brand-olive text-brand-beige">
              <thead class="bg-brand-olive">
                <tr>
                  <th class="p-4 px-3 text-left font-semibold align-middle">No</th>
                  <th class="p-4 px-3 text-left font-semibold align-middle">Order ID</th>
                  <th class="p-4 px-3 text-left font-semibold align-middle">User ID</th>
                  <th class="p-4 px-3 text-left font-semibold align-middle">Jumlah Denda</th>
                  <th class="p-4 px-3 text-left font-semibold align-middle">Status</th>
                  <th class="p-4 px-3 text-left font-semibold align-middle">Aksi</th>
                </tr>
              </thead>
              <tbody class="bg-brand-beige text-brand-brown">
                <% fines.forEach((fine, idx) => { %>
                  <tr>
                    <td class="p-4 px-3 align-middle font-bold text-sm"><%= idx + 1 %></td>
                    <td class="p-4 px-3 align-middle font-bold text-sm"><%= fine.orderId %></td>
                    <td class="p-4 px-3 align-middle font-bold text-sm"><%= fine.userId || '-' %></td>
                    <td class="p-4 px-3 align-middle font-bold text-sm">Rp <%= Number(fine.amount).toLocaleString('id-ID') %></td>
                    <td class="p-4 px-3 align-middle">
                      <select id="status-<%= fine.id %>" class="border rounded px-2 py-1">
                        <option value="pending" <%= fine.status === 'pending' ? 'selected' : '' %>>Pending</option>
                        <option value="paid" <%= fine.status === 'paid' ? 'selected' : '' %>>Paid</option>
                        <option value="waived" <%= fine.status === 'waived' ? 'selected' : '' %>>Waived</option>
                      </select>
                    </td>
                    <td class="p-4 px-3 align-middle">
                      <button onclick="updateFineStatus(<%= fine.id %>)" class="bg-brand-olive text-brand-beige px-3 py-1 rounded hover:bg-brand-olive-dark">Simpan</button>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </main>
    </div>
  </div>

  <script>
    async function updateFineStatus(fineId) {
      const status = document.getElementById(`status-${fineId}`).value;
      const res = await fetch(`/admin/fines/${fineId}/status`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status })
      });
      const result = await res.json();
      if (result.success) {
        Swal.fire('Berhasil', 'Status denda diperbarui!', 'success');
      } else {
        Swal.fire('Gagal', result.message || 'Gagal update status denda', 'error');
      }
    }
  </script>
</body>
</html>